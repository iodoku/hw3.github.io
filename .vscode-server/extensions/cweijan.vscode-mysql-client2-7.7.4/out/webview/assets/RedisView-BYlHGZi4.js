import{l as de,q as f,a as D,r as w,z as O,C as A,o as d,e as N,f as E,h as o,E as c,D as h,g as a,t as U,N as G,$,J as ce,K as me,y as q,c as B,j as _,G as L,ag as pe,F as H,x as ye,Z as Q,a1 as W,M as ve,av as fe}from"./app-CSosM33B.js";import{R as ge}from"./constants-BpYHMiwN.js";import{d as Z}from"./objectUtil-Z6JRxuBJ.js";import{E as _e,u as ke}from"./dialogStore-DXn_v1DM.js";import{c as be,s as he,p as xe,l as we}from"./common_view_utils-COSTzBo1.js";import{e as J,c as X,s as ee}from"./notify-B3uo9RRx.js";import{E as te,a as le}from"./index-DT1kZQY9.js";import{E as ne}from"./index-Dig24fm9.js";import{E as Se}from"./index-CwAalyKH.js";import{E as Ve,a as ae}from"./index-CcxL_kiJ.js";import{E as Ee}from"./index-ZTo4Eioy.js";import{E as Ce,a as Ie}from"./index-CjUXJ7DM.js";import{c as ze,s as Ne}from"./codemirror-CKhW-kxh.js";import"./focus-trap-oW3Oz0pJ.js";import"./validator-DN1lxiX_.js";import"./isEqual-B2A1MZL7.js";import"./index-B69GrENz.js";import"./index-3vLwHw63.js";import"./index-D5RJZE9_.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-CcDVmX61.js";import"./castArray-84ZwkcTC.js";import"./isUndefined-DCTLXrZ8.js";import"./clone-CdkeVV7A.js";import"./_baseClone-B546CWjF.js";import"./_initCloneObject-C1N_ki7v.js";import"./merge-_9lU3S1-.js";import"./isArrayLikeObject-C0bNowXW.js";import"./index-DpC6it7c.js";import"./_commonjsHelpers-Cpj98o6Y.js";const F=de("redis",{state:()=>({remainHeight:0,edit:{name:"",ttl:-1,content:null},key:{name:"",ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(i){if(i!=null&&(this.itemModel.value=i),!this.edit.name)return J("Key name cannot be null!");f.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),Te=i=>(ce("data-v-109341ab"),i=i(),me(),i),$e={id:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},Re={key:1,class:"key-label key-detail-type"},Be=Te(()=>E("span",{class:"key-label"},"TTL",-1)),Ue=D({__name:"RedisKeyInfo",setup(i){const t=w(!1),e=F(),{key:l,edit:m}=O(e),g=()=>{X($("confirm.deleteRedisKey")).then(()=>{f.emit("del",{key:{name:e.key.name}}),e.key={},e.edit={}})},S=()=>{f.emit("rename",{key:{name:e.key.name,newName:e.edit.name}})},k=()=>{f.emit("ttl",{key:{name:e.key.name,ttl:e.edit.ttl}})};return f.on("new",()=>{t.value=!0}),f.on("detail",()=>{t.value=!1}),setInterval(()=>{document.activeElement.tagName!=="INPUT"&&m.value.ttl>0&&(m.value.ttl-=1)},1e3),(C,p)=>{const y=te,u=le,v=ne,b=A("vsc-button");return d(),N("div",$e,[E("div",null,[o(v,{ref:"keyNameInput",modelValue:a(m).name,"onUpdate:modelValue":p[1]||(p[1]=x=>a(m).name=x),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:G(S,["enter"])},{prepend:c(()=>[t.value?(d(),h(u,{key:0,modelValue:a(l).type,"onUpdate:modelValue":p[0]||(p[0]=x=>a(l).type=x),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:c(()=>[o(y,{value:"string",label:"STRING"}),o(y,{value:"list",label:"LIST"}),o(y,{value:"set",label:"SET"}),o(y,{value:"zset",label:"ZSET"}),o(y,{value:"hash",label:"HASH"}),o(y,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(d(),N("span",Re,U(a(l).type),1))]),_:1},8,["modelValue"]),o(b,{class:"ml-1",size:"mini",icon:"el-icon-document-copy",onClick:p[2]||(p[2]=x=>a(be)(a(m).name))}),o(b,{icon:"el-icon-refresh",size:"mini",type:"secondary",onClick:p[3]||(p[3]=x=>{a(f).emit("refresh")})})]),E("div",null,[o(v,{modelValue:a(m).ttl,"onUpdate:modelValue":p[4]||(p[4]=x=>a(m).ttl=x),size:"small",class:"mr-1",style:{width:"220px"},onKeyup:G(k,["enter"])},{prepend:c(()=>[Be]),_:1},8,["modelValue"]),o(b,{icon:"codicon codicon-save",size:"mini",onClick:k}),o(b,{icon:"el-icon-delete",size:"mini",type:"secondary",onClick:g})])])}}}),Me=q(Ue,[["__scopeId","data-v-109341ab"]]),Le={key:0},De={id:"listPanel"},Fe={class:"ml-2 inline-block"},Ke=["title","textContent"],Pe=D({__name:"RedisListView",setup(i){const t=F(),{key:e,itemModel:l,remainHeight:m}=O(t),g=w(""),S=w(""),k=w(1),C=w(100),p=w(0),y=w(!1);f.on("detail",r=>{y.value=!1,k.value=r.page.pageNum,C.value=r.page.pageSize}).on("pagination",r=>{t.key.content=r}).on("success",()=>{y.value=!1});const u=B(()=>{const r=t.itemModel.old;let n=e.value.type;return n=n.charAt(0).toUpperCase()+n.slice(1),`${r?"Edit":"Add to"} ${n}`}),v=B(()=>{const r=e.value.type;switch(r){case"list":return"Element";case"hash":return"Value";case"set":case"zset":return"Member";case"stream":return"Entry";default:return r.charAt(0).toUpperCase()+r.slice(1)}}),b=(r,n)=>{f.emit("changePage",n?r:k.value+r)},x=()=>{y.value=!0,t.itemModel={old:null,key:null,index:null,score:null,value:null}},K=B(()=>{e.value.content||(e.value.content=[]);const r=g.value,n=S.value,z=e.value.content.filter(V=>!(r&&e.value.type=="hash"&&!`${V.key}`.match(new RegExp(r,"i"))||n&&!`${V.value??V}`.match(new RegExp(n,"i"))));return p.value=e.value.count??z.length,z}),P=r=>{X($("confirm.deleteRedisKey")).then(()=>{f.emit("deleteLine",r)})},I=r=>{navigator.clipboard.writeText(r.value??r),ee($("common.copied"))},oe=r=>{t.itemModel={...r,old:{...r}},y.value=!0};return(r,n)=>{const z=ne,V=A("vsc-button"),Y=Se,ie=_e,M=Ve,se=ae,re=Ee,T=Ce,ue=Ie;return["list","hash","set","zset","stream"].includes(a(e).type)?(d(),N("div",Le,[E("div",De,[a(e).type=="hash"?(d(),h(z,{key:0,modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=s=>g.value=s),class:"filter-input mb-2 mr-2",size:"small",style:{width:"120px"},placeholder:a($)("result.searchField"),clearable:!0},null,8,["modelValue","placeholder"])):_("",!0),o(z,{modelValue:S.value,"onUpdate:modelValue":n[1]||(n[1]=s=>S.value=s),class:"filter-input mb-2",size:"small",style:{width:"200px"},placeholder:a($)("result.searchNotice"),clearable:!0},null,8,["modelValue","placeholder"]),o(Y,{class:"item",effect:"dark",content:"Add new key",placement:"bottom-start"},{default:c(()=>[E("div",Fe,[a(e).type!="stream"?(d(),h(V,{key:0,type:"icon",icon:"codicon-add text-lg",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:n[2]||(n[2]=s=>x())})):_("",!0)])]),_:1}),o(ie,{"page-size":C.value,"onUpdate:pageSize":n[3]||(n[3]=s=>C.value=s),"current-page":k.value,"onUpdate:currentPage":n[4]||(n[4]=s=>k.value=s),small:!0,total:p.value,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:n[5]||(n[5]=s=>b(s,!0)),onNextClick:n[6]||(n[6]=()=>b(1)),onPrevClick:n[7]||(n[7]=()=>b(-1))},null,8,["page-size","current-page","total"]),o(re,{modelValue:y.value,"onUpdate:modelValue":n[14]||(n[14]=s=>y.value=s),title:u.value,closeOnClickModal:!1,width:"30%",class:"new-item-dialog"},{footer:c(()=>[o(V,{type:"secondary",onClick:n[12]||(n[12]=s=>y.value=!1)},{default:c(()=>[L(U(a($)("common.cancel")),1)]),_:1}),o(V,{type:"primary",onClick:n[13]||(n[13]=s=>a(t).saveListItem())},{default:c(()=>[L("Confirm")]),_:1})]),default:c(()=>[o(se,{"label-width":"60px"},{default:c(()=>[a(e).type=="list"?(d(),h(M,{key:0,label:"Index"},{default:c(()=>[o(z,{modelValue:a(l).index,"onUpdate:modelValue":n[8]||(n[8]=s=>a(l).index=s),size:"small",disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),a(e).type=="hash"?(d(),h(M,{key:1,label:"Field"},{default:c(()=>[o(z,{modelValue:a(l).key,"onUpdate:modelValue":n[9]||(n[9]=s=>a(l).key=s),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),a(e).type=="zset"?(d(),h(M,{key:2,label:"Score"},{default:c(()=>[o(z,{modelValue:a(l).score,"onUpdate:modelValue":n[10]||(n[10]=s=>a(l).score=s),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),o(M,{label:v.value},{default:c(()=>[o(z,{modelValue:a(l).value,"onUpdate:modelValue":n[11]||(n[11]=s=>a(l).value=s),size:"small"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])]),E("div",null,[o(ue,{data:K.value,height:a(m),border:""},{default:c(()=>[a(e).type=="list"?(d(),h(T,{key:0,label:"Index",prop:"index",sortable:"",width:"90",align:"center"})):_("",!0),a(e).type=="hash"?(d(),h(T,{key:1,"sort-by":"key",resizable:"",sortable:"",label:"Field",align:"center",width:"200",prop:"key"})):_("",!0),a(e).type=="zset"?(d(),h(T,{key:2,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):_("",!0),a(e).type=="stream"?(d(),h(T,{key:3,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):_("",!0),o(T,{"sort-by":"value",resizable:"",sortable:"",label:v.value,align:"center"},{default:c(s=>{var R;return[E("span",{class:"item-value",title:s.row.value,textContent:U(((R=s.row)==null?void 0:R.value)||s.row)},null,8,Ke)]}),_:1},8,["label"]),o(T,{label:"Operation",width:"150",align:"center"},{default:c(s=>[o(V,{type:"icon",icon:"codicon-copy",title:"View On Dialog",onClick:R=>{I(s.row)}},null,8,["onClick"]),["list","hash","set","zset"].includes(a(e).type)?(d(),h(V,{key:0,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:R=>oe(s.row)},null,8,["onClick"])):_("",!0),o(V,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:R=>P(s.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):_("",!0)}}}),Oe=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Ae=["B","k","M","G","T","P","E","Z","Y"],Je=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Ye=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],j=(i,t,e)=>{let l=i;return typeof t=="string"||Array.isArray(t)?l=i.toLocaleString(t,e):(t===!0||e!==void 0)&&(l=i.toLocaleString(void 0,e)),l};function Ge(i,t){if(i==null||!Number.isFinite(i)&&(i=parseInt(i),!Number.isFinite(i)))return"";t={bits:!1,binary:!0,...t};const e=t.bits?t.binary?Ye:Je:t.binary?Ae:Oe;if(t.signed&&i===0)return` 0 ${e[0]}`;const l=i<0,m=l?"-":t.signed?"+":"";l&&(i=-i);let g;if(t.minimumFractionDigits!==void 0&&(g={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(g={maximumFractionDigits:t.maximumFractionDigits,...g}),i<1){const p=j(i,t.locale,g);return m+p+" "+e[0]}const S=Math.min(Math.floor(t.binary?Math.log(i)/Math.log(1024):Math.log10(i)/3),e.length-1);i/=(t.binary,1024**S),g||(i=i.toPrecision(3));const k=j(Number(i),t.locale,g),C=e[S];return`${m+k}${C}`}const He={key:0,id:"stringPanel",class:"flex pr-4 mb-2 gap-x-3"},Ze={key:0,class:"flex"},je={class:"value-panel"},qe=D({__name:"RedisStringView",setup(i){const t=F(),{key:e}=O(t),l=w(""),m=w("Text"),g=w(Ne),S=B(()=>{var u;return Ge(((u=l.value)==null?void 0:u.length)||0)}),k=B(()=>["string","ReJSON-RL"].includes(t.key.type));window.addEventListener("keydown",u=>{k.value&&pe(u)&&u.code=="KeyS"&&C()});const C=()=>{if(!t.edit.name)return J("Key name cannot be null!");f.emit("update",{key:{name:t.key.name,newName:t.edit.name,type:t.key.type,ttl:t.edit.ttl,content:l.value}})};f.on("detailNext",()=>{p()});const p=()=>{if(!k.value)return l.value="";const u=t.edit.content,v=(u==null?void 0:u.match(/^\s*[{[]/))!=null;m.value=v?"JSON":"Text",v?y(u):l.value=u},y=u=>{var v;try{l.value=he(xe((v=u==null?void 0:u.replace)==null?void 0:v.call(u,/Â /g," ")),null,2)}catch(b){console.error(b),l.value=u}};return(u,v)=>{const b=te,x=le,K=A("vsc-button"),P=ae;return d(),N(H,null,[["string","ReJSON-RL"].includes(a(e).type)?(d(),N("div",He,[E("div",null," Size: "+U(S.value),1),["string","ReJSON-RL"].includes(a(e).type)?(d(),N("div",Ze,[o(x,{modelValue:m.value,"onUpdate:modelValue":v[0]||(v[0]=I=>m.value=I),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:c(()=>[(d(!0),N(H,null,ye(g.value,I=>(d(),h(b,{key:I,value:I},{default:c(()=>[L(U(I),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(K,{class:"inline",icon:"codicon codicon-save",style:{height:"27px"},onClick:C},{default:c(()=>[L("Save")]),_:1})])):_("",!0)])):_("",!0),Q(o(P,null,{default:c(()=>[E("div",je,[o(ze,{ref:"cmEditor",value:l.value,"onUpdate:value":v[1]||(v[1]=I=>l.value=I),language:m.value,class:"json-panel",style:ve("height:"+a(t).remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[W,["string","ReJSON-RL"].includes(a(e).type)]])],64)}}}),Qe=q(qe,[["__scopeId","data-v-757feae2"]]),We={class:"redis-view-container"},Xe={key:0,style:{"text-align":"center"}},et={class:"mx-2"},Tt=D({__name:"RedisView",setup(i){const t=w(!0),e=F();return ke(),fe(()=>{we(100,[],l=>{e.remainHeight=l}),f.on("new",({prefix:l})=>{t.value=!1,e.key={name:l,type:ge.STRING,ttl:-1},e.edit=Z(e.key)}).on("detail",l=>{t.value=!1,e.key=l.res,e.edit=Z(l.res),f.emitImmediately("detailNext")}).on("error",l=>{J(l)}).on("success",l=>{ee(l)}),f.emit("init")}),(l,m)=>(d(),N("div",We,[t.value?(d(),N("div",Xe," loading ")):_("",!0),Q(E("div",et,[o(Me),o(Pe),o(Qe)],512),[[W,!t.value]])]))}});export{Tt as default};
